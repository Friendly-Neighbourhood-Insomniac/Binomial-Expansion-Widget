<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binomial Expansion Visualizer</title>
    <script type="importmap">
    {
        "imports": {
            "three": "https://esm.sh/three@0.158.0",
            "three/addons/": "https://esm.sh/three@0.158.0/examples/jsm/",
            "katex": "https://esm.sh/katex@0.16.8",
            "chart.js": "https://esm.sh/chart.js@4.4.0",
            "chartjs-adapter-date-fns": "https://esm.sh/chartjs-adapter-date-fns@3.0.0"
        }
    }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="light">
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark/light mode">
        <span class="theme-icon">üåô</span>
    </button>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h2>Welcome to Binomial Expansion Visualizer</h2>
                <button class="tutorial-close" id="tutorialClose">√ó</button>
            </div>
            <div class="tutorial-body" id="tutorialBody">
                <div class="tutorial-step active" data-step="0">
                    <h3>üéØ Getting Started</h3>
                    <p>This interactive tool helps you explore the binomial theorem: <strong>(a + b)‚Åø</strong></p>
                    <p>Use the controls on the left to adjust coefficients and see real-time visualizations.</p>
                </div>
                <div class="tutorial-step" data-step="1">
                    <h3>üéõÔ∏è Control Panel</h3>
                    <p>Adjust the power (n) and coefficients (a, b) using the sliders.</p>
                    <p>Try dragging the power slider to see how the expansion changes!</p>
                </div>
                <div class="tutorial-step" data-step="2">
                    <h3>üìä Visualizations</h3>
                    <p>The chart shows binomial coefficients and term values.</p>
                    <p>Pascal's triangle highlights the coefficients used in your expansion.</p>
                </div>
                <div class="tutorial-step" data-step="3">
                    <h3>üßÆ Step-by-Step Mode</h3>
                    <p>Enable step-by-step mode to see how each term is derived.</p>
                    <p>Perfect for learning the binomial theorem!</p>
                </div>
                <div class="tutorial-step" data-step="4">
                    <h3>üåê 3D Visualization</h3>
                    <p>Switch to the 3D tab to see a spatial representation of the coefficients.</p>
                    <p>Rotate and zoom to explore from different angles!</p>
                </div>
            </div>
            <div class="tutorial-navigation">
                <button class="btn-secondary" id="tutorialPrev">Previous</button>
                <span class="tutorial-progress" id="tutorialProgress">1 / 5</span>
                <button class="btn-primary" id="tutorialNext">Next</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header class="hero-section">
            <h1 class="title">Binomial Expansion Visualizer</h1>
            <p class="subtitle">Explore the beauty of (a + b)‚Åø through interactive mathematics</p>
            <button class="btn-secondary tutorial-trigger" id="startTutorial">Start Tutorial</button>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="2d">2D Visualization</button>
            <button class="tab-button" data-tab="3d">3D Surface Plot</button>
            <button class="tab-button" data-tab="steps">Step-by-Step</button>
        </div>

        <div class="main-content">
            <!-- Control Panel -->
            <div class="control-panel">
                <div class="controls-group">
                    <h3>Expression Parameters</h3>
                    
                    <div class="input-group">
                        <label for="powerN">Power (n):</label>
                        <input type="range" id="powerN" min="0" max="12" value="4" class="slider" data-tooltip="Drag to change power">
                        <span class="value-display" id="powerValue">4</span>
                    </div>

                    <div class="input-group">
                        <label for="coeffA">Coefficient a:</label>
                        <input type="range" id="coeffA" min="-5" max="5" step="0.1" value="1" class="slider">
                        <span class="value-display" id="coeffAValue">1</span>
                    </div>

                    <div class="input-group">
                        <label for="coeffB">Coefficient b:</label>
                        <input type="range" id="coeffB" min="-5" max="5" step="0.1" value="1" class="slider">
                        <span class="value-display" id="coeffBValue">1</span>
                    </div>

                    <div class="input-group">
                        <label for="xValue">Evaluate at x:</label>
                        <input type="range" id="xValue" min="-3" max="3" step="0.1" value="1" class="slider">
                        <span class="value-display" id="xValueDisplay">1</span>
                    </div>

                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="showPascal" checked>
                            Show Pascal's Triangle
                        </label>
                        <label>
                            <input type="checkbox" id="animateExpansion" checked>
                            Animate Terms
                        </label>
                        <label>
                            <input type="checkbox" id="enableParticles">
                            Particle Effects
                        </label>
                        <label>
                            <input type="checkbox" id="stepByStepMode">
                            Step-by-Step Mode
                        </label>
                    </div>

                    <div class="animation-controls">
                        <h4>Animation Speed</h4>
                        <input type="range" id="animationSpeed" min="0.5" max="3" step="0.1" value="1" class="slider">
                        <span class="value-display" id="speedValue">1x</span>
                    </div>
                </div>
            </div>

            <!-- Tab Content Areas -->
            <div class="tab-content active" data-tab="2d">
                <div class="visualization-area">
                    <div class="expression-display">
                        <div class="current-expression" id="currentExpression"></div>
                        <div class="expanded-form" id="expandedForm"></div>
                        <div class="numerical-result" id="numericalResult"></div>
                    </div>

                    <div class="visual-container">
                        <div class="chart-section">
                            <canvas id="coefficientsChart"></canvas>
                        </div>
                        
                        <div class="pascal-section" id="pascalTriangle"></div>
                    </div>

                    <div class="terms-breakdown" id="termsBreakdown"></div>
                </div>
            </div>

            <div class="tab-content" data-tab="3d">
                <div class="visualization-area">
                    <div class="expression-display">
                        <div class="current-expression" id="currentExpression3D"></div>
                        <div class="surface-info">
                            <p>Interactive 3D surface showing binomial coefficients across different powers</p>
                            <div class="surface-controls">
                                <button class="btn-secondary" id="resetCamera">Reset View</button>
                                <button class="btn-secondary" id="autoRotate">Auto Rotate</button>
                            </div>
                        </div>
                    </div>
                    <div class="threejs-container" id="threejsContainer"></div>
                </div>
            </div>

            <div class="tab-content" data-tab="steps">
                <div class="visualization-area">
                    <div class="expression-display">
                        <div class="current-expression" id="currentExpressionSteps"></div>
                        <div class="step-controls">
                            <button class="btn-secondary" id="prevStep">‚Üê Previous</button>
                            <span class="step-indicator" id="stepIndicator">Step 1 of 5</span>
                            <button class="btn-primary" id="nextStep">Next ‚Üí</button>
                        </div>
                    </div>
                    <div class="steps-container" id="stepsContainer"></div>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h3>About Binomial Expansion</h3>
            <p>The binomial theorem describes the algebraic expansion of powers of a binomial. According to the theorem:</p>
            <div class="formula-display" id="generalFormula"></div>
            <p>Where C(n,k) represents the binomial coefficients, also known as "n choose k".</p>
            
            <div class="performance-info" id="performanceInfo">
                <small>Performance: <span id="fpsCounter">60 FPS</span> | Calculations: <span id="calcTime">0ms</span></small>
            </div>
        </div>
    </div>

    <!-- Particle Canvas -->
    <canvas id="particleCanvas" class="particle-canvas"></canvas>

    <!-- Error Boundary -->
    <div class="error-boundary" id="errorBoundary" style="display: none;">
        <div class="error-content">
            <h3>‚ö†Ô∏è Something went wrong</h3>
            <p id="errorMessage">An unexpected error occurred. Please refresh the page.</p>
            <button class="btn-primary" onclick="location.reload()">Refresh Page</button>
        </div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module" src="three-visualization.js"></script>
    <script type="module" src="particles.js"></script>
    <script type="module" src="tutorial.js"></script>
    <script type="module" src="performance.js"></script>
</body>
</html>